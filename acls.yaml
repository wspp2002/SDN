---
acls:
    rate-limit-guest:
    - rule:
        actions:
          allow: True
          meter: "guest"
    mgmt-port-security:
    - rule: { dl_src: "00:00:00:00:00:01", actions: { allow: 1 } }
    - rule: { dl_src: "00:00:00:00:00:05", actions: { allow: 1 } }
    - rule: { actions: { allow: 0 } }
    
    guest-egress-block:
    - rule: { dl_type: 0x800, ipv4_src: 10.0.200.0/24, ipv4_dst: 10.0.0.0/24,   actions: { allow: 0 } }    # guest -> mgmt
    - rule: { dl_type: 0x800, ipv4_src: 10.0.200.0/24, ipv4_dst: 10.0.100.0/24, actions: { allow: 0 } }    # guest -> office
    - rule: { dl_type: 0x800, ipv4_src: 10.0.200.0/24, ipv4_dst: 10.0.200.0/24, actions: { allow: 1 } }    # guest -> guest
    - rule: { actions: { allow: 1 } }

    # Alles wat UIT office komt, mag NIET naar het guest-subnet
    office-egress-block-to-guest:
    - rule: { dl_type: 0x800, ipv4_dst: 10.0.200.0/24, actions: { allow: 0 } }
    - rule: { actions: { allow: 1 } }

     # Alles wat UIT management komt, mag NIET naar het guest-subnet
    mgmt-egress-block-to-guest:
    - rule: { dl_type: 0x800, ipv4_dst: 10.0.200.0/24, actions: { allow: 0 } }
    - rule: { actions: { allow: 1 } }

    access-port-protect:
        # Drop dhcp servers
        - rule:
              dl_type: 0x800      # ipv4
              nw_proto: 17        # udp
              udp_src: 67         # bootps
              udp_dst: 68         # bootpc
              actions:
                  allow: 0        # drop
        # Drop dhcpv6 servers
        - rule:
              dl_type: 0x86dd     # ipv6
              nw_proto: 17        # udp
              udp_src: 547        # dhcpv6-server
              udp_dst: 546        # dhcpv6-client
              actions:
                  allow: 0        # drop
        # Drop icmpv6 RAs
        - rule:
              dl_type: 0x86dd     # ipv6
              nw_proto: 58        # icmpv6
              icmpv6_type: 134    # router advertisement
              actions:
                  allow: 0        # drop
        # Drop SMTP
        - rule:
              dl_type: 0x800      # ipv4
              nw_proto: 6         # tcp
              tcp_dst: 25         # smtp
              actions:
                  allow: 0        # drop
        # Force DNS to our DNS server
        - rule:
              dl_type: 0x800      # ipv4
              nw_proto: 17        # udp
              udp_dst: 53         # dns
              actions:
                  output:
                      set_fields:
                          - eth_dst: "72:b8:3c:4c:dc:4d"
                      port: "s1"  # s1 container
        # Force DNS to our DNS server
        - rule:
              dl_type: 0x800      # ipv4
              nw_proto: 6         # tcp
              tcp_dst: 53         # dns
              actions:
                  output:
                      set_fields:
                          - eth_dst: "72:b8:3c:4c:dc:4d"
                      port: "s1"  # s1 container
        - rule:
              actions:
                  allow: 1        # allow

    service-port-protect:
        # Drop icmpv6 RAs
        - rule:
              dl_type: 0x86dd     # ipv6
              nw_proto: 58        # icmpv6
              icmpv6_type: 134    # router advertisement
              actions:
                  allow: 0        # drop
        # Drop SMTP
        - rule:
              dl_type: 0x800      # ipv4
              nw_proto: 6         # tcp
              tcp_dst: 25         # smtp
              actions:
                  allow: 0        # drop
        - rule:
              actions:
                  allow: 1        # allow

meters:
    "guest":
        meter_id: 1
        entry:
            flags:
                - "KBPS"
            bands:
                - type: "DROP"
                  rate: 2000   # 2 Mbps cap
                  burst_size: 1000